<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>The SW6 Club</title>
    <link rel="icon" type="image/png" href="/favicon.png" />
    <link rel="apple-touch-icon" href="/favicon.png" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Sora:wght@400;500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <main class="app-shell">
      <header class="hero">
        <div class="hero-main">
          <div class="hero-title-row">
            <h1>The SW6 Club</h1>
            <span class="hero-beta-badge">In Beta</span>
          </div>
          <p>Your completely unofficial Chelsea score predictor.</p>
        </div>
        <div class="hero-meta">
          <p id="deadline-countdown" class="hero-deadline"></p>
          <p id="matchday-attendance" class="hero-attendance">Matchday attendance: ...</p>
          <p id="visitor-count" class="hero-attendance hidden"></p>
        </div>
      </header>

      <section class="panel auth-thin" id="auth-panel">
        <div class="top-nav-row">
          <div class="top-nav" role="tablist" aria-label="Primary navigation">
            <button id="topnav-predict" type="button" class="tab-btn active" role="tab" aria-selected="true">Predict</button>
            <button id="topnav-leagues" type="button" class="tab-btn" role="tab" aria-selected="false">Leagues</button>
            <button id="topnav-results" type="button" class="tab-btn" role="tab" aria-selected="false">Fixtures &amp; Stats</button>
            <button id="topnav-cards" type="button" class="tab-btn" role="tab" aria-selected="false">Collectables</button>
            <button id="topnav-forum" type="button" class="tab-btn" role="tab" aria-selected="false">
              The Concourse
              <span id="forum-unread-badge" class="nav-unread-badge hidden" aria-label="Unread forum notifications">0</span>
            </button>
          </div>
          <div class="account-actions">
            <a id="account-signin-link" class="account-auth-btn" href="login.html">Sign in</a>
            <a id="account-signup-link" class="account-auth-btn" href="signup.html">Sign up</a>
            <a id="account-edit-profile-top-link" class="account-auth-btn hidden" href="profile.html">Edit profile</a>
            <button id="account-signout-quick-btn" type="button" class="account-auth-btn hidden">Sign out</button>
          </div>
        </div>
        <p id="session-status" class="status auth-inline-status hidden"></p>
      </section>

      <section class="panel prediction-primary" id="predict-view" data-view="predict">
        <p class="section-kicker">Predict</p>
        <div class="predict-head">
          <h2 class="fixtures-title">Next Chelsea Match Prediction</h2>
          <button id="open-rules-inline" type="button" class="inline-rules-link">Rules</button>
        </div>
        <section id="signedout-preview-panel" class="signedout-preview hidden" aria-live="polite">
          <article class="signedout-preview-card">
            <h3>Next Fixture</h3>
            <p id="signedout-next-fixture-line" class="no-margin">Chelsea vs ...</p>
            <p id="signedout-next-fixture-meta" class="status no-margin">Kickoff: -- | Locks at: --</p>
            <p id="signedout-next-fixture-updated" class="status no-margin">Last updated: --</p>
          </article>
          <article class="signedout-preview-card">
            <h3>Lock Countdown</h3>
            <p id="signedout-lock-countdown" class="no-margin">Loading countdown...</p>
          </article>
          <article class="signedout-preview-card">
            <h3>Global Top 10 Preview</h3>
            <ul id="signedout-top10-list" class="leaderboard"></ul>
            <p id="signedout-top10-status" class="status no-margin">Loading standings...</p>
            <a class="ghost-btn signedout-cta-link" href="login.html?redirect=%2F%23predict">See full leaderboard (sign in)</a>
          </article>
          <article class="signedout-preview-card">
            <h3>Why sign in</h3>
            <ul class="rules-list">
              <li>Submit predictions</li>
              <li>Compete in leagues</li>
              <li>Earn Matchday Moments</li>
            </ul>
          </article>
        </section>
        <div id="config-error-banner" class="config-error-banner hidden" role="status" aria-live="polite">
          Configuration error. Some features are temporarily unavailable.
        </div>
        <div id="predict-auth-gate" class="auth-gate-card hidden">
          <p class="no-margin"><strong>Sign in to start playing.</strong></p>
          <div class="auth-gate-actions">
            <a href="login.html" class="account-auth-btn">Sign in</a>
            <a href="signup.html" class="account-auth-btn">Sign up</a>
          </div>
        </div>
        <ul id="fixtures-list" class="fixtures-list"></ul>
        <section id="admin-score-panel" class="admin-score-panel hidden"></section>
      </section>

      <section class="panel overview-panel hidden" id="results-view" data-view="results">
        <p class="section-kicker">Results</p>
        <div class="overview-tabs" role="tablist" aria-label="Results views">
          <button id="results-fixtures-tab" type="button" class="tab-btn active" role="tab" aria-selected="true">Fixtures</button>
          <button id="results-past-tab" type="button" class="tab-btn" role="tab" aria-selected="false">Past Games</button>
        </div>

        <div id="fixtures-overview-panel">
          <div class="upcoming-head">
            <h2>Upcoming Chelsea Fixtures</h2>
            <button id="upcoming-toggle-btn" type="button" class="ghost-btn">Show All</button>
          </div>
          <p id="upcoming-source" class="status no-margin"></p>
          <ul id="upcoming-list" class="upcoming-list"></ul>
        </div>

        <div id="past-overview-panel" class="hidden">
          <h2>Past Games</h2>
          <ul id="past-games-list" class="past-games-list"></ul>
          <p id="past-games-status" class="status no-margin"></p>
        </div>

      </section>

      <section class="panel hidden" id="league-panel" data-view="leagues">
          <h2>My Leagues</h2>
          <div id="league-auth-gate" class="auth-gate-card hidden">
            <p class="no-margin"><strong>Sign in to start playing.</strong></p>
            <p class="status no-margin">Join the Global League and compete with other Chelsea fans.</p>
            <div class="auth-gate-actions">
              <a href="login.html?redirect=%2F%23leagues" class="account-auth-btn">Sign in</a>
              <a href="signup.html?redirect=%2F%23leagues" class="account-auth-btn">Sign up</a>
            </div>
          </div>
          <div id="league-auth-content">
          <div class="league-forms">
            <form id="create-league-form" class="mini-form">
              <h3>Create League</h3>
              <label class="field-slot">
                League type
                <select id="league-visibility-input" required>
                  <option value="public">Public</option>
                  <option value="private">Private</option>
                </select>
              </label>
              <label class="field-slot">
                League name
                <input id="league-name-input" type="text" required />
              </label>
              <label id="league-password-wrap" class="field-slot inactive">
                Private league password
                <input id="league-password-input" type="password" minlength="6" placeholder="Minimum 6 characters" />
              </label>
              <button type="submit">Create</button>
            </form>

            <form id="join-league-form" class="mini-form">
              <h3>Join League</h3>
              <label class="field-slot">
                Join mode
                <select id="join-mode-input" required>
                  <option value="public">Public (League code)</option>
                  <option value="private">Private (Name + Password)</option>
                </select>
              </label>
              <label id="join-code-wrap" class="field-slot">
                League code
                <input id="join-code-input" type="text" placeholder="e.g., SW6A7KQ9" />
              </label>
              <label id="join-private-name-wrap" class="field-slot inactive">
                Private league name
                <input id="join-private-name-input" type="text" placeholder="Exact league name" />
              </label>
              <label id="join-private-password-wrap" class="field-slot inactive">
                Private league password
                <input id="join-private-password-input" type="password" placeholder="Password" />
              </label>
              <button type="submit">Join</button>
            </form>
          </div>

          <div class="league-meta">
            <label>
              Active league
              <select id="league-select"></select>
            </label>
            <div class="league-meta-actions">
              <p id="league-meta-note" class="status no-margin hidden">Global League is open to all signed-in users.</p>
              <button id="copy-code-btn" type="button" class="ghost-btn">Copy code</button>
              <button id="copy-invite-link-btn" type="button" class="ghost-btn">Copy invite link</button>
            </div>
          </div>

          <div class="dashboard-grid">
            <article class="subpanel">
              <h3>League Leaderboard</h3>
              <ul id="leaderboard" class="leaderboard"></ul>
              <p id="league-leaderboard-status" class="status no-margin"></p>
            </article>
            <article class="subpanel">
              <h3>Global Leaderboard</h3>
              <ul id="overall-leaderboard" class="leaderboard"></ul>
              <p id="overall-leaderboard-status" class="status no-margin"></p>
            </article>
          </div>
          </div>
      </section>

      <section class="panel hidden" id="forum-panel" data-view="forum">
          <h2>The Concourse</h2>
          <div id="forum-auth-gate" class="auth-gate-card hidden">
            <p class="no-margin"><strong>Sign in to start playing.</strong></p>
            <p class="status no-margin">Share matchday thoughts and join the post-match chat.</p>
            <div class="auth-gate-actions">
              <a href="login.html?redirect=%2F%23forum" class="account-auth-btn">Sign in</a>
              <a href="signup.html?redirect=%2F%23forum" class="account-auth-btn">Sign up</a>
            </div>
          </div>
          <form id="forum-thread-form" class="mini-form">
            <label>
              New thread title
              <input id="forum-thread-title-input" type="text" maxlength="120" required />
            </label>
            <label>
              Message
              <textarea id="forum-thread-body-input" rows="4" maxlength="2000" required></textarea>
            </label>
            <button id="forum-thread-submit-btn" type="submit">Post Thread</button>
          </form>
          <p id="forum-status" class="status no-margin"></p>
          <div id="forum-sort-toolbar" class="overview-tabs">
            <button id="forum-sort-new" type="button" class="tab-btn active" aria-pressed="true">New</button>
            <button id="forum-sort-top" type="button" class="tab-btn" aria-pressed="false">Top</button>
          </div>
          <ul id="forum-thread-list" class="prediction-list"></ul>

          <article id="forum-thread-detail" class="subpanel hidden">
            <div class="forum-thread-detail-head">
              <button id="forum-back-btn" type="button" class="ghost-btn">Back to The Concourse</button>
              <button id="forum-delete-thread-btn" type="button" class="danger-btn hidden">Delete Thread</button>
            </div>
            <h3 id="forum-thread-detail-title">Thread</h3>
            <p id="forum-thread-detail-meta" class="status no-margin"></p>
            <p id="forum-thread-detail-body" class="no-margin"></p>
            <ul id="forum-reply-list" class="prediction-list forum-comment-list"></ul>
            <form id="forum-reply-form" class="mini-form">
              <label>
                Add comment
                <textarea id="forum-reply-body-input" rows="3" maxlength="1500" required></textarea>
              </label>
              <button id="forum-reply-submit-btn" type="submit">Post Comment</button>
            </form>
          </article>
      </section>

      <section class="panel hidden" id="cards-panel" data-view="cards">
        <h2>Matchday Collectables</h2>
        <div id="cards-auth-gate" class="auth-gate-card hidden">
          <p class="no-margin"><strong>Sign in to start playing.</strong></p>
          <p class="status no-margin">Earn limited matchday collectables from your predictions.</p>
          <div class="cards-grid" aria-hidden="true">
            <article class="moment-card rarity-common is-locked">
              <div class="moment-card-hit">
                <div class="moment-card-head"><span class="moment-rarity-pill">Common</span></div>
                <h3 class="moment-card-title">Correct Result</h3>
                <p class="moment-card-context">Chelsea vs Opponent</p>
                <p class="moment-card-score">2-1</p>
              </div>
            </article>
            <article class="moment-card rarity-rare is-locked">
              <div class="moment-card-hit">
                <div class="moment-card-head"><span class="moment-rarity-pill">Rare</span></div>
                <h3 class="moment-card-title">First Chelsea Scorer</h3>
                <p class="moment-card-context">Chelsea vs Opponent</p>
                <p class="moment-card-score">1-0</p>
              </div>
            </article>
          </div>
          <div class="auth-gate-actions">
            <a href="login.html?redirect=%2F%23cards" class="account-auth-btn">Sign in</a>
            <a href="signup.html?redirect=%2F%23cards" class="account-auth-btn">Sign up</a>
          </div>
        </div>
        <div id="cards-content">
          <div class="cards-toolbar">
            <p id="cards-summary" class="status no-margin">Loading collectables...</p>
            <div class="cards-filter-row">
              <div class="cards-filter-group" role="tablist" aria-label="Collectables fixture filter">
                <button id="cards-filter-all" type="button" class="tab-btn active" role="tab" aria-selected="true">All</button>
                <button id="cards-filter-match" type="button" class="tab-btn" role="tab" aria-selected="false">This Match</button>
              </div>
              <div class="cards-filter-group" role="tablist" aria-label="Collectables rarity filter">
                <button id="cards-rarity-all" type="button" class="tab-btn active" role="tab" aria-selected="true">All Rarities</button>
                <button id="cards-rarity-common" type="button" class="tab-btn" role="tab" aria-selected="false">Common</button>
                <button id="cards-rarity-rare" type="button" class="tab-btn" role="tab" aria-selected="false">Rare</button>
                <button id="cards-rarity-legendary" type="button" class="tab-btn" role="tab" aria-selected="false">Legendary</button>
              </div>
            </div>
          </div>
          <div id="cards-empty" class="empty-state hidden">
            No collectables yet. Submit predictions and score well to earn your first Matchday Moment.
          </div>
          <ul id="cards-grid" class="cards-grid" aria-live="polite"></ul>
        </div>
      </section>

      <div id="card-detail-modal" class="rules-modal hidden" role="dialog" aria-modal="true" aria-labelledby="card-detail-title">
        <section class="panel rules-modal-content card-detail-modal-content">
          <div class="rules-modal-head">
            <h2 id="card-detail-title">Collectable</h2>
            <button id="close-card-detail-modal" type="button" class="ghost-btn">Close</button>
          </div>
          <div id="card-detail-body"></div>
          <div class="card-detail-actions">
            <button id="copy-card-link-btn" type="button" class="ghost-btn">Copy link</button>
          </div>
        </section>
      </div>

      <div id="draft-save-modal" class="rules-modal hidden" role="dialog" aria-modal="true" aria-labelledby="draft-save-title">
        <section class="panel rules-modal-content">
          <div class="rules-modal-head">
            <h2 id="draft-save-title">Draft Saved</h2>
            <button id="close-draft-save-modal" type="button" class="ghost-btn">Close</button>
          </div>
          <p>Your picks are saved on this device. Sign in to submit before the lock.</p>
          <div class="auth-gate-actions">
            <a class="account-auth-btn" href="login.html?redirect=%2F%23predict">Sign in</a>
            <a class="account-auth-btn" href="signup.html?redirect=%2F%23predict">Sign up</a>
          </div>
        </section>
      </div>

      <div id="rules-modal" class="rules-modal hidden" role="dialog" aria-modal="true" aria-labelledby="rules-title">
        <section class="panel rules-modal-content">
          <div class="rules-modal-head">
            <h2 id="rules-title">Game Rules</h2>
            <button id="close-rules-modal" type="button" class="ghost-btn">Close</button>
          </div>
          <ul class="rules-list">
            <li><strong>Who can predict:</strong> Anyone logged in can submit a prediction.</li>
            <li><strong>Which fixture:</strong> You can only predict the next Chelsea fixture.</li>
            <li><strong>Deadline:</strong> Predictions lock 90 minutes before kick-off.</li>
            <li><strong>Chelsea goals:</strong> Auto-calculated from selected Chelsea goalscorers.</li>
            <li><strong>First scorer:</strong> Must be selected from your chosen goalscorers when Chelsea are predicted to score.</li>
          </ul>
          <h3>Scoring</h3>
          <ul class="rules-list">
            <li>Exact score: <strong>+5</strong></li>
            <li>Correct result (win/draw/loss), but not exact: <strong>+2</strong></li>
            <li>Correct Chelsea goals: <strong>+1</strong></li>
            <li>Correct opponent goals: <strong>+1</strong></li>
            <li>Each correct Chelsea goalscorer (no cap): <strong>+1 each</strong></li>
            <li>Correct first Chelsea scorer: <strong>+2</strong></li>
            <li>Perfect bonus (exact score + correct first scorer): <strong>+1</strong></li>
            <li>No prediction before deadline: <strong>0</strong></li>
          </ul>
        </section>
      </div>
    </main>

    <footer class="site-footer">
      <p>Unofficial fan project. Not affiliated with Chelsea FC.</p>
      <p>
        <button id="open-rules-footer" type="button" class="inline-rules-link">Rules</button>
        <a href="privacy.html" class="inline-rules-link">Privacy Policy</a>
        <a href="https://www.thesheddiaries.com" class="inline-rules-link" target="_blank" rel="noopener noreferrer">The Shed Diaries</a>
      </p>
    </footer>

    <template id="fixture-template">
      <li class="fixture-item">
        <div class="fixture-head">
          <p class="fixture-title"></p>
          <span class="status-badge"></span>
        </div>
        <p class="fixture-meta"></p>
        <div class="fixture-body">
          <form class="prediction-form">
            <p class="mini-title">Your Prediction</p>
            <div class="scoreboard-picker">
              <div class="score-team">
                <p class="score-team-name pred-opponent-name">Opponent</p>
                <div class="score-stepper">
                  <button type="button" class="score-minus score-minus-opponent">-</button>
                  <span class="score-value score-value-opponent">0</span>
                  <button type="button" class="score-plus score-plus-opponent">+</button>
                </div>
              </div>
              <p class="score-separator">:</p>
              <div class="score-team">
                <p class="score-team-name">Chelsea</p>
                <div class="score-stepper">
                  <button type="button" class="score-minus score-minus-chelsea">-</button>
                  <span class="score-value score-value-chelsea">0</span>
                  <button type="button" class="score-plus score-plus-chelsea">+</button>
                </div>
              </div>
            </div>
            <input class="pred-chelsea" type="number" min="0" required hidden />
            <input class="pred-opponent" type="number" min="0" required hidden />
            <div class="goalscorer-picker">
              <p class="mini-title no-margin">Select Goalscorers</p>
              <p class="prediction-ack hidden" aria-live="polite"></p>
              <p class="status no-margin">Selected: <span class="selected-scorer-value">None</span></p>
              <input class="pred-scorer" type="text" readonly placeholder="Pick players below" />
              <ul class="selected-scorer-list"></ul>
              <label>
                First Chelsea goalscorer
                <select class="pred-first-scorer" required>
                  <option value="">Select from chosen scorers</option>
                </select>
              </label>
              <div class="scorer-group">
                <p class="scorer-group-title">Chelsea Registered Players by Position</p>
                <div class="player-chip-wrap player-chip-wrap-chelsea"></div>
              </div>
            </div>
            <button type="submit">Save Prediction</button>
          </form>
        </div>

      </li>
    </template>

    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="/build-meta.js"></script>
    <script src="/runtime-config.js"></script>
    <script src="/app.js"></script>
  </body>
</html>
